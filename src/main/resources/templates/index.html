<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8" />
<title>Calendar Event</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" type="text/css" href="@{/css/main.css}">
<link rel="stylesheet" type="text/css" th:href="@{/icons/style.css}">
<!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">

</head>
<body>
<header>
	<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <a class="navbar-brand ml-3" href="#">Calendar-Event</a>
    <form class="form-inline my-2 my-lg-0">
      <button class="btn btn-outline-success my-2 my-sm-0" type="submit" formaction="/login.html">Login</button>
    </form>
</nav>
</header>

	<div class="main" style="display: flex;">
		<div style="margin-right: 10px;">
			<div id="nav"></div>
		</div>
		<div style="flex-grow: 1">
			<div id="dp"></div>
		</div>
	</div>

	<!-- DayPilot library -->
	<script src="js/daypilot/daypilot-all.min.js"></script>

	<script>
		var nav = new DayPilot.Navigator("nav");
		nav.showMonths = 3;
		nav.skipMonths = 3;
		nav.selectMode = "week";
		nav.onTimeRangeSelected = function(args) {
			dp.startDate = args.day;
			dp.update();
			dp.events.load("http://localhost:8282/api/events");
		};
		nav.init();

		var dp = new DayPilot.Calendar("dp");
		
		//Hien thi cac event
		dp.viewType = "Week";
		dp.onTimeRangeSelected = function(args) {
			DayPilot.Modal.prompt("Create a new event:", "Event").then(
					function(modal) {
						var dp = args.control;
						dp.clearSelection();
						if (!modal.result) {
							return;
						}
						var params = {
							start : args.start.toString(),
							end : args.end.toString(),
							text : modal.result
						};
						DayPilot.Http.ajax({
							url : 'http://localhost:8282/api/events/create',
							data : params,
							success : function(ajax) {
								var data = ajax.data;
								dp.events.add(new DayPilot.Event(data));
								dp.message("Event created");
							}
						});
					});
		};
		
		//Xoa cac event
		dp.eventDeleteHandling = "Update";
		
		dp.onEventDelete = function(args) {
		    if (!confirm("Do you really want to delete this event?")) {
		      args.preventDefault();
		    }
		  };
		  dp.onEventDeleted = function(args) {
			  var params = {
						id : args.e.id()
					};
					DayPilot.Http.ajax({
						url : 'http://localhost:8282/api/events/move',
						data : params,
						success : function(ajax) {
							dp.message("Event deleted");
						}
					});
		  };
		  
		  //Thay doi event

		dp.onEventMove = function(args) {
			var params = {
				id : args.e.id(),
				start : args.newStart.toString(),
				end : args.newEnd.toString()
			};
			DayPilot.Http.ajax({
				url : 'http://localhost:8282/api/events/update',
				data : params,
				success : function(ajax) {
					dp.message("Event moved");
				}
			});
		};
		
		//Di chuyen sang mot thoi gian khac
		dp.onEventResize = function(args) {
			var params = {
				id : args.e.id(),
				start : args.newStart.toString(),
				end : args.newEnd.toString()
			};
			DayPilot.Http.ajax({
				url : 'http://localhost:8282/api/events/update',
				data : params,
				success : function(ajax) {
					dp.message("Event resized");
				}
			});
		};
		
		//Chon mau event
		dp.onBeforeEventRender = function(args) {
			args.data.barColor = args.data.color;
			args.data.areas = [ {
				bottom : 2,
				right : 2,
				icon : "icon-triangle-down",
				visibility : "Visible",
				action : "ContextMenu",
				style : "font-size: 12px; background-color: #f9f9f9; border: 1px solid #ccc; padding: 2px 2px 0px 2px; cursor:pointer;"
			} ];
		};
		dp.contextMenu = new DayPilot.Menu({
			items : [ {
				text : "Blue",
				icon : "icon icon-blue",
				color : "#1066a8",
				onClick : function(args) {
					updateColor(args.source, args.item.color);
				}
			}, {
				text : "Green",
				icon : "icon icon-green",
				color : "#6aa84f",
				onClick : function(args) {
					updateColor(args.source, args.item.color);
				}
			}, {
				text : "Yellow",
				icon : "icon icon-yellow",
				color : "#f1c232",
				onClick : function(args) {
					updateColor(args.source, args.item.color);
				}
			}, {
				text : "Red",
				icon : "icon icon-red",
				color : "#cc0000",
				onClick : function(args) {
					updateColor(args.source, args.item.color);
				}
			},

			]
		});
		dp.init();

		dp.events.load("/api/events");

		function updateColor(e, color) {
			var params = {
				id : e.id(),
				color : color
			};
			DayPilot.Http.ajax({
				url : 'http://localhost:8282/api/events/setColor',
				data : params,
				success : function(ajax) {
					e.data.color = color;
					dp.events.update(e);
					dp.message("Color updated");
				}
			});
		}
	</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
</body>
</html>
